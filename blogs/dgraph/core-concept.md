---
topic: 'dgraph'
slug: '/dgraph/core-concept'
title: '核心概念'
date: '2019-05-04'
---

## 三元组

Dgraph 是图数据库，所有的数据都在一张图中，往下看之前你可以想想用什么结构去表达一张图呢？dgraph 采用的是三元组(triple)，它是 dgraph 中的最小数据单元，它的结构是“主体-谓语-对象/值”，如下面所示：

```
{
  set {
    _:jim <name> "Jim" .
    _:tom <name> "Tom" .

    _:jim <friend> _:tom .
  }
}

```

非常复合直觉，把上面的语句复制到控制台（或发送 http 请求），就直接生成图数据了。好了，现在你已经学会在 dgraph 中如何插入数据了。

> 你可能疑惑`_:jim`是什么，是这样的，dgraph 会为每个节点创建一个 16 进制的数字作为 uid，<0x1>。但是在新插入数据的时候还没 uid 呢，所以就先写一个“假”(Blank Id)的 uid，这样你就可以无障碍的表达节点之间的关系了。你可以认为它们是临时变量。“真”uid 要这样写`<0x1>`，如`<0x1> <name> "Joe"`，样就是修改数据了，好了，修改数据你也会了。

## 节点和边

在未了解 dgraph 之前，你可能会认为 Jim 和 Tom 是都是节点，friend(他们之间的关系)是一条边，name 只是他们各自的属性。而在 dgraph 中，无论是 friend 还是 name 都是边，在底层它们被完全**无差别**对待。也就是说，dgraph 并不存在任何的复合结构，任何的复合结构在内部都会存成边。也即是说，dgraph 是一个纯**原子化**的存储系统，后续你会看到这个特性为它提供超高的灵活性和强大的能力。

> 现在碰到复合结构的时候，你应该不必像在其他数据库那样，纠结到底是做嵌套还是级联了，因为只能是边。

## 边的属性

在某些场景下，你需要给边加属性(Facats)，比如用户关联消息的时候，你需要标记已读或未读。它的语法同样符合直觉：

```
_:jim <messages> _:message (read = false) .
```

边的属性同样支持增删改查。

## 索引

dgraph 是设计用来做主数据库的，因此它支持所有常规的索引。如字符串，支持正则，全文，单词匹配，hash；数字支持大于，大于等于，小于，小于等于；日期只是年，月，日，小时；地址位置支持附近，位于等等...

> 注意 dgraph 只支持在值节点上添加索引。

## 总结

以上就是 dgraph 的全部数据单元，dgraph 底层又把它们无差别的存储在一个名为 Badger 的 key-value 数据库里。可见 dgraph 的架构及其简洁，几乎不需要什么前置知识，后续我将带你探索 dgraph 的强大功能。
